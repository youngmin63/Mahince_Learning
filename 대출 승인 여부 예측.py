# -*- coding: utf-8 -*-
"""1Final_credit_Template_ê¶Œì˜ë¯¼_202215053.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1lbBBcNgl2yGJ2BlGaWVpAXkgIgVZkyg9

# ğŸ’³ ëŒ€ì¶œ ìŠ¹ì¸ ì—¬ë¶€ ì˜ˆì¸¡(Loan Approval Status Prediction)
ëª©ì : ëŒ€ì¶œ ì‹ ì²­ìì˜ íŠ¹ì„± ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—°ì²´ ì—¬ë¶€(0/1)ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë¶„ë¥˜ ëª¨ë¸ êµ¬ì¶•

#### 1. ë°ì´í„° ì „ì²˜ë¦¬
- ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ ì œê±° (ì˜ˆ: `Unnamed: 0`)
- **ê²°ì¸¡ì¹˜ ì²˜ë¦¬**
  - `Saving accounts`, `Checking account` ë“± ê²°ì¸¡ì¹˜ ìˆëŠ” ë³€ìˆ˜ì— ëŒ€í•œ ì²˜ë¦¬ ë°©ë²• ì œì‹œ
- **ë²”ì£¼í˜• ë³€ìˆ˜ ì¸ì½”ë”©**
  - `Sex`, `Housing`, `Purpose`, `Saving accounts`, `Checking account` ë“±
- **ì—°ì†í˜• ë³€ìˆ˜ ìŠ¤ì¼€ì¼ë§**
  - `Age`, `Credit amount`, `Duration` ë“±ì„ `StandardScaler` ë“±ìœ¼ë¡œ ì •ê·œí™”
- **Xì™€ y ë¶„í• **
  - `Creditability`ë¥¼ íƒ€ê¹ƒ ë³€ìˆ˜(y)ë¡œ ì„¤ì •, ë‚˜ë¨¸ì§€ë¥¼ Xë¡œ êµ¬ì„±

#### 2. ëª¨ë¸ë§ ë° ì„±ëŠ¥ í‰ê°€
- `train_test_split`ì„ í†µí•œ ë°ì´í„° ë¶„í• 
- ë¡œì§€ìŠ¤í‹± íšŒê·€ ë“± ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµ
- ì •í™•ë„(`Accuracy`), ì¬í˜„ìœ¨(`Recall`), ì •ë°€ë„(`Precision`), F1-score ë“± í‰ê°€ ì§€í‘œ ì¶œë ¥
- í˜¼ë™ í–‰ë ¬ ì‹œê°í™”

#### 3. ë³€ìˆ˜ ì¤‘ìš”ë„ ì‹œê°í™”
- ë¡œì§€ìŠ¤í‹± íšŒê·€ ê³„ìˆ˜ ë˜ëŠ” íŠ¸ë¦¬ ëª¨ë¸ì˜ `feature_importances_` ì‹œê°í™”
- ëŒ€ì¶œ ìŠ¹ì¸ì— ì˜í–¥ì„ ë¯¸ì¹œ ì£¼ìš” ë³€ìˆ˜ í•´ì„

#### 4. ê²°ê³¼ í•´ì„
- ëŒ€ì¶œ ìŠ¹ì¸ì— ì˜í–¥ì„ ë¯¸ì¹œ ì£¼ìš” ìš”ì¸ì€?
  - ì˜ˆ: `Credit amount`, `Duration`, `Checking account` ë“±
- ì‹ ìš©ë„ê°€ ë‚®ì€(= bad creditability) ê³ ê°ì˜ ì£¼ìš” íŠ¹ì„±ì€?
- ì„±ë³„, ë‚˜ì´, ëª©ì  ë“± ë³€ìˆ˜ì— ë”°ë¼ ëŒ€ì¶œ ìŠ¹ì¸ ê²½í–¥ì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ê°€?

### âœ… ë³€ìˆ˜ ì„¤ëª… (German Credit Data ê¸°ì¤€)

| ë³€ìˆ˜ëª… | ì„¤ëª… |
|--------|------|
| `Age` | ê³ ê°ì˜ ë‚˜ì´ |
| `Sex` | ì„±ë³„ (male/female) |
| `Job` | ì§ì—… êµ¬ë¶„ (0~3: ìˆ«ìê°€ í´ìˆ˜ë¡ ì•ˆì •ì ì¸ ì§ì—…) |
| `Housing` | ì£¼ê±° í˜•íƒœ (own: ìê°€, rent: ì„ëŒ€, free: ë¬´ìƒ ê±°ì£¼) |
| `Saving accounts` | ì €ì¶• ê³„ì¢Œ ì”ê³  ìˆ˜ì¤€ (little, moderate, quite rich ë“±) |
| `Checking account` | ë‹¹ì¢Œì˜ˆê¸ˆ ê³„ì¢Œ ìƒíƒœ (none, little, moderate ë“±) |
| `Credit amount` | ëŒ€ì¶œ ì‹ ì²­ ê¸ˆì•¡ |
| `Duration` | ëŒ€ì¶œ ìƒí™˜ ê¸°ê°„ (ê°œì›” ìˆ˜) |
| `Purpose` | ëŒ€ì¶œ ëª©ì  (car, furniture/equipment, education ë“±) |
| `Creditability` | ëŒ€ì¶œ ìŠ¹ì¸ ì—¬ë¶€(good: ìŠ¹ì¸, bad: ê±°ì ˆ) |
"""

# ğŸ“¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, confusion_matrix, ConfusionMatrixDisplay, roc_auc_score, roc_curve

# ğŸ“¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv('german_credit.csv')  # ì˜ˆ: Kaggle German Credit Data
df.head()

# ğŸ” EDA & ê²°ì¸¡ì¹˜ í™•ì¸
print(df.info())
print(df.describe())
sns.countplot(x='Creditability', data=df)

# ì „ì²˜ë¦¬

# Unnamed: 0 ì»¬ëŸ¼ ì œê±°
# ë¶„ì„ì— í•„ìš” ì—†ëŠ” ì¸ë±ìŠ¤ìš© ì»¬ëŸ¼ì´ë¯€ë¡œ ì œê±°
df = df.drop(columns=["Unnamed: 0"])

# ê²°ì¸¡ì¹˜ ì²˜ë¦¬
# Saving accountsì™€ Checking accountëŠ” ê²°ì¸¡ì´ ë§ìœ¼ë‚˜, ê²°ì¸¡ ìì²´ë„ í•˜ë‚˜ì˜ ì˜ë¯¸ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 'missing'ìœ¼ë¡œ ëŒ€ì²´
df["Saving accounts"] = df["Saving accounts"].fillna("missing")
df["Checking account"] = df["Checking account"].fillna("missing")

# ë²”ì£¼í˜• ë³€ìˆ˜ ì¸ì½”ë”© (OneHotEncoding)
# ë¬¸ìì—´ ë²”ì£¼ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì´ ì´í•´í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ë³€í™˜
# drop_first=Trueë¥¼ í†µí•´ ë”ë¯¸ ë³€ìˆ˜ í•¨ì •(dummy variable trap) ë°©ì§€
categorical_cols = ["Sex", "Housing", "Saving accounts", "Checking account", "Purpose"]
df_encoded = pd.get_dummies(df, columns=categorical_cols, drop_first=True)

# íƒ€ê¹ƒ ë³€ìˆ˜ ì´ì§„í™”
# Creditabilityë¥¼ 'good' â†’ 1, 'bad' â†’ 0ìœ¼ë¡œ ë§¤í•‘í•˜ì—¬ ì´ì§„ ë¶„ë¥˜ ë¬¸ì œë¡œ ì„¤ì •
df_encoded["Creditability"] = df_encoded["Creditability"].map({"good": 1, "bad": 0})

# ìˆ˜ì¹˜í˜• ë³€ìˆ˜ ìŠ¤ì¼€ì¼ë§
# ì—°ì†í˜• ë³€ìˆ˜ë“¤ ê°„ ìŠ¤ì¼€ì¼ ì°¨ì´ë¥¼ ì¤„ì´ê¸° ìœ„í•´ StandardScaler ì‚¬ìš©
scale_cols = ["Age", "Credit amount", "Duration"]
scaler = StandardScaler()
df_encoded[scale_cols] = scaler.fit_transform(df_encoded[scale_cols])

# X, y ë¶„ë¦¬
X = df_encoded.drop("Creditability", axis=1)
y = df_encoded["Creditability"]

# í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„í• 
# stratify=yë¥¼ ì‚¬ìš©í•´ í•™ìŠµ/í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ ê°„ í´ë˜ìŠ¤ ë¹„ìœ¨ ìœ ì§€
# random_state ê³ ì •ìœ¼ë¡œ ì¬í˜„ ê°€ëŠ¥ì„± í™•ë³´
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

# ê²°ê³¼ í™•ì¸
print("ì „ì²˜ë¦¬ ì™„ë£Œ")
print(f"Train: {X_train.shape}, Test: {X_test.shape}")

# ëª¨ë¸ í•™ìŠµ
# Logistic Regressionì€ ë³€ìˆ˜ì˜ ì˜í–¥ë ¥ì„ ê³„ìˆ˜ë¡œ í•´ì„í•  ìˆ˜ ìˆì–´ ê¸ˆìœµ ë¶„ì•¼ì—ì„œ ìì£¼ ì‚¬ìš©ë¨
model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)

# ì˜ˆì¸¡ ìˆ˜í–‰
y_pred = model.predict(X_test)               # í´ë˜ìŠ¤ ì˜ˆì¸¡ (0 ë˜ëŠ” 1)
y_proba = model.predict_proba(X_test)[:, 1]  # í´ë˜ìŠ¤ 1ì¼ í™•ë¥  ì˜ˆì¸¡

# ë¶„ë¥˜ ì„±ëŠ¥ í‰ê°€
print("Classification Report")
print(classification_report(y_test, y_pred, target_names=["bad (0)", "good (1)"]))

# í˜¼ë™ í–‰ë ¬ ì‹œê°í™”
cm = confusion_matrix(y_test, y_pred)
disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=["bad (0)", "good (1)"])
disp.plot(cmap='Blues')
plt.title("Confusion Matrix")
plt.show()

# ROC AUC ì ìˆ˜ ë° ê³¡ì„ 
auc = roc_auc_score(y_test, y_proba)
fpr, tpr, thresholds = roc_curve(y_test, y_proba)

plt.figure()
plt.plot(fpr, tpr, label=f"ROC Curve (AUC = {auc:.2f})")
plt.plot([0, 1], [0, 1], 'k--')  # ëŒ€ê°ì„  ê¸°ì¤€ì„ 
plt.xlabel("False Positive Rate")
plt.ylabel("True Positive Rate")
plt.title("ROC Curve - Logistic Regression")
plt.legend()
plt.grid()
plt.show()

"""## ğŸ§  ëª¨ë¸ í›ˆë ¨: Logistic Regression

- **ì„ íƒ ì´ìœ **:
  - ê¸ˆìœµ ë„ë©”ì¸ì—ì„œëŠ” í•´ì„ ê°€ëŠ¥í•œ ëª¨ë¸ì´ ì¤‘ìš”í•˜ë©°, Logistic Regressionì€ ê° ë³€ìˆ˜ì˜ ì˜í–¥ë ¥ì„ ê³„ìˆ˜ë¡œ í•´ì„í•  ìˆ˜ ìˆìŒ
  - ì´ì§„ ë¶„ë¥˜ ë¬¸ì œì— ì í•©í•˜ë©°, ë² ì´ìŠ¤ë¼ì¸ ëª¨ë¸ë¡œ ìì£¼ ì‚¬ìš©ë¨

## ğŸ“Š ì„±ëŠ¥ í‰ê°€ ë° í•´ì„

- **ì •í™•ë„ (Accuracy)**: ì „ì²´ ì˜ˆì¸¡ ì¤‘ ì˜¬ë°”ë¥¸ ë¹„ìœ¨
- **ì •ë°€ë„ (Precision)**: `good`ìœ¼ë¡œ ì˜ˆì¸¡í•œ ê²ƒ ì¤‘ ì‹¤ì œ `good`ì¸ ë¹„ìœ¨
- **ì¬í˜„ìœ¨ (Recall)**: ì‹¤ì œ `good` ì¤‘ ëª¨ë¸ì´ ì˜ ë§ì¶˜ ë¹„ìœ¨ â†’ **ì‹ ìš©ë„ ë†’ì€ ê³ ê°ì„ ë†“ì¹˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¤‘ìš”**í•  ê²½ìš°, recallì´ ì¤‘ìš”
- **F1 Score**: Precisionê³¼ Recallì˜ ì¡°í™” í‰ê· 
- **ROC AUC**: ì „ì²´ ë¶„ë¥˜ ì„±ëŠ¥ì„ í‰ê°€í•˜ëŠ” í†µí•© ì§€í‘œ

- **Confusion Matrix**ë¥¼ í†µí•´ ì˜ëª» ì˜ˆì¸¡í•œ íŒ¨í„´ì„ ì‹œê°ì ìœ¼ë¡œ íŒŒì•… ê°€ëŠ¥
- **ROC Curve**ëŠ” threshold ë³€ê²½ì— ë”°ë¥¸ ë¯¼ê°ë„ì™€ íŠ¹ì´ë„ ê°„ trade-offë¥¼ ë³´ì—¬ì¤Œ
"""

# ë³€ìˆ˜ ì´ë¦„ê³¼ íšŒê·€ ê³„ìˆ˜ ì¶”ì¶œ
feature_names = X.columns
coefficients = model.coef_[0]  # Logistic Regressionì˜ ê³„ìˆ˜

# ì ˆëŒ€ê°’ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ì˜í–¥ë ¥ í° ë³€ìˆ˜ ìˆœ ì •ë ¬
coef_df = pd.DataFrame({
    "Feature": feature_names,
    "Coefficient": coefficients,
    "AbsValue": np.abs(coefficients)
}).sort_values(by="AbsValue", ascending=False)

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
sns.barplot(x="Coefficient", y="Feature", data=coef_df.head(15), palette="coolwarm")
plt.title("ğŸ” Logistic Regression - ë³€ìˆ˜ ì¤‘ìš”ë„ ìƒìœ„ 15ê°œ")
plt.xlabel("íšŒê·€ ê³„ìˆ˜ (ì–‘/ìŒì— ë”°ë¼ ì˜í–¥ ë°©í–¥ ë‹¤ë¦„)")
plt.ylabel("ë³€ìˆ˜ëª…")
plt.grid(True)
plt.tight_layout()
plt.show()

"""## ğŸ“Œ ë³€ìˆ˜ ì¤‘ìš”ë„ í•´ì„ (Logistic Regression ê¸°ì¤€)

- íšŒê·€ ê³„ìˆ˜ê°€ **ì–‘ìˆ˜**ì¸ ë³€ìˆ˜ëŠ” `Creditability = good`ì— **ê¸ì •ì ì¸ ì˜í–¥**ì„ ì£¼ëŠ” ë³€ìˆ˜
- íšŒê·€ ê³„ìˆ˜ê°€ **ìŒìˆ˜**ì¸ ë³€ìˆ˜ëŠ” `Creditability = bad` (ì—°ì²´ ìœ„í—˜)ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë³€ìˆ˜
- ê³„ìˆ˜ì˜ **ì ˆëŒ€ê°’**ì´ í´ìˆ˜ë¡ ëª¨ë¸ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ë ¥ì´ í¼

ì˜ˆì‹œ í•´ì„:
- `Duration`ì´ ë†’ì„ìˆ˜ë¡ ì—°ì²´ ê°€ëŠ¥ì„±ì´ ì¦ê°€ â†’ ìŒì˜ ê³„ìˆ˜
- `Checking account_missing`ì´ ì–‘ì˜ ê³„ìˆ˜ë¼ë©´, Checking ê³„ì¢Œ ì •ë³´ê°€ ì—†ì„ìˆ˜ë¡ ì˜¤íˆë ¤ ì‹ ìš©ë„ê°€ ì¢‹ê²Œ íŒë‹¨ëœ ê²ƒì¼ ìˆ˜ë„ ìˆìŒ (ë°ì´í„°ì…‹ íŠ¹ì´ì„± ë°˜ì˜ í•„ìš”)

# **ğŸ“ ê²°ê³¼ í•´ì„ ë° ì‹œì‚¬ì **

# 1. ì—°ì²´ ì—¬ë¶€ ì˜ˆì¸¡ì— ê¸°ì—¬í•œ ì£¼ìš” ë³€ìˆ˜

Logistic Regression ê³„ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì—°ì²´ ì—¬ë¶€ì— ê°€ì¥ ì˜í–¥ì„ ì¤€ ë³€ìˆ˜ë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŒ:

Duration: ëŒ€ì¶œ ìƒí™˜ ê¸°ê°„ì´ ê¸¸ìˆ˜ë¡ ì—°ì²´ ìœ„í—˜ì´ ì¦ê°€

Credit amount: ëŒ€ì¶œ ê¸ˆì•¡ì´ í´ìˆ˜ë¡ ì—°ì²´ ìœ„í—˜ì´ ì•½ê°„ ì¦ê°€

Checking account_none ë˜ëŠ” Saving accounts_missing: ê¸ˆìœµ ê±°ë˜ ê¸°ë¡ì´ ë¶€ì¡±í•œ ê²½ìš° ì—°ì²´ ê°€ëŠ¥ì„±ì´ ë†’ê²Œ ì˜ˆì¸¡ë¨

Purpose_education, Purpose_business: íŠ¹ì • ëŒ€ì¶œ ëª©ì ì´ ì—°ì²´ì™€ ì—°ê´€


ì¦‰, ìƒí™˜ ëŠ¥ë ¥ì„ ì§ì ‘ì ìœ¼ë¡œ ë°˜ì˜í•˜ëŠ” ë³€ìˆ˜(ì˜ˆ: ìƒí™˜ ê¸°ê°„, ê¸ˆì•¡, ê³„ì¢Œ ê¸°ë¡ ìœ ë¬´)ê°€ ì‹ ìš©ë„ë¥¼ íŒë‹¨í•˜ëŠ” ë° í•µì‹¬ ì—­í• ì„ í•¨.



# **2. ê¸ˆìœµ ë¬¸ë§¥ì—ì„œ ì¤‘ìš”í•œ ì„±ëŠ¥ ì§€í‘œ: Recall **

Recall	ì‹¤ì œ ì—°ì²´ì ì¤‘ì— ì–¼ë§ˆë‚˜ ë§ì´ ë§ì·„ëŠ”ê°€	 ì¤‘ìš”! â†’ ë¦¬ìŠ¤í¬ ê´€ë¦¬ì˜ í•µì‹¬
Precision	ì˜ˆì¸¡í•œ ì—°ì²´ì ì¤‘ ì‹¤ì œ ì—°ì²´ ë¹„ìœ¨	ì¤‘ìš”í•˜ì§€ë§Œ recallë³´ë‹¨ ëœ ì¤‘ìš”

ê¸ˆìœµì—ì„œëŠ” ì—°ì²´ìë¥¼ ë†“ì¹˜ì§€ ì•ŠëŠ” ê²ƒ(False Negative ë°©ì§€)ì´ ê°€ì¥ ì¤‘ìš”

ì—°ì²´ìì—ê²Œ ëŒ€ì¶œì„ ìŠ¹ì¸í•˜ë©´ ê¸ˆì „ì  ì†ì‹¤ë¡œ ì§ê²°ë˜ê¸° ë•Œë¬¸

ë”°ë¼ì„œ Recallì´ Precisionë³´ë‹¤ ë” ì¤‘ìš”í•œ ì§€í‘œë¡œ ê°„ì£¼ë¨



# 3. í–¥í›„ ê°œì„  ë°©í–¥ ì œì•ˆ

1.ë°ì´í„° ë³´ê°•:

í˜„ì¬ ë°ì´í„°ëŠ” ì¼ë¶€ ë²”ì£¼í˜• ë³€ìˆ˜ì— ê²°ì¸¡ì¹˜ê°€ ë§ê³ , ì—°ì²´ ì—¬ë¶€ì˜ ë¶„í¬ë„ ë‹¨ìˆœí•¨

ì¶”ê°€ì ì¸ ì‚¬ìš©ì ì •ë³´(ì˜ˆ: ì†Œë“, ì‹ ìš©ë“±ê¸‰, ê³¼ê±° ëŒ€ì¶œ ì´ë ¥ ë“±) í™•ë³´ ì‹œ ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥

2.ë‹¤ì–‘í•œ ëª¨ë¸ ì ìš© ë° ë¹„êµ:

í˜„ì¬ëŠ” Logistic Regression ë‹¨ì¼ ëª¨ë¸ë§Œ ì‚¬ìš©

í–¥í›„ì—ëŠ” Random Forest, XGBoost ë“± ë‹¤ì–‘í•œ ë¶„ë¥˜ê¸°ë¥¼ ì ìš©í•´ ì„±ëŠ¥ ë¹„êµ ê°€ëŠ¥

3.SMOTE ë“± ë¶ˆê· í˜• ì²˜ë¦¬ ì ìš©:

ì—°ì²´ì ë¹„ìœ¨ì´ ë‚®ì€ ê²½ìš°, SMOTE, ì–¸ë”ìƒ˜í”Œë§ ë“±ìœ¼ë¡œ í´ë˜ìŠ¤ ê· í˜• ë§ì¶”ë©´ ì„±ëŠ¥ ê°œì„  ê°€ëŠ¥

4.ë¹„ì •í˜• ë°ì´í„° í™œìš©:

ë¡œê·¸ ë°ì´í„°, í…ìŠ¤íŠ¸ ì½”ë©˜íŠ¸ ë“±ë„ í¬í•¨ì‹œí‚¬ ê²½ìš° ì‹¤ë¬´ í™œìš©ì„± ì¦ê°€



**<ë§ˆë¬´ë¦¬ ìš”ì•½>**

ì—°ì²´ ì˜ˆì¸¡ì—ëŠ” ê¸ˆìœµ ì •ë³´ì˜ ìœ ë¬´(Checking/Saving account)ì™€ ìƒí™˜ ê¸°ê°„(Duration)ì´ íŠ¹íˆ ì¤‘ìš”

Recall ì¤‘ì‹¬ì˜ í‰ê°€ ê¸°ì¤€ì´ ê¸ˆìœµ ë¦¬ìŠ¤í¬ ìµœì†Œí™”ì— ì í•©

í–¥í›„ì—ëŠ” ëª¨ë¸ ë‹¤ì–‘í™”, ë°ì´í„° í™•ì¥, ë¹„ì •í˜• ë°ì´í„° ì—°ê³„ ë“±ì„ í†µí•´ ê³ ë„í™” ê°€ëŠ¥
"""



